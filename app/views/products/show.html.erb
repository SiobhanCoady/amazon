<h1><%= @product.title %> - $<%= sprintf('%.2f', @product.price) %></h1>
<p><%= @product.description %></p>
<p><%= @product.user.first_name %></p>
<p><strong>Category: </strong><%= @product.category&.name %></p>

<% if can? :edit, @product %>
  <%= link_to 'Edit', edit_product_path(@product) %>
<% end %>

<% if can? :destroy, @product %>
  <%= link_to 'Delete', product_path(@product),
                        method: :delete,
                        data: { confirm: 'Are you sure?' } %>
<% end %>

<h2>Reviews</h2>

<%= @review.errors.full_messages.join(', ') %>
<%= form_for [@product, @review] do |f| %>
  <%= f.text_area :body %>
  <%= f.number_field :rating, in: 1..5 %>
  <%= f.submit %>
<% end %>

<hr>

<% @product.reviews.each do |review| %>
  <% if (can? :edit, @product) && review.is_hidden? %>
    <div class="well" style="background-color: darkgrey">
      <p><%= review.body %></p>
      <p><%= review.user.first_name %></p>
      <p><strong>Rating: </strong><%= review.rating %></p>
      <% if can? :edit, @product %>
        <%= link_to 'Show', product_review_path(@product, review), method: :patch %>
      <% end %>
      <% if can? :destroy, review %>
        <%= link_to(
        'Delete',
        product_review_path(@product, review),
        method: :delete,
        data: { confirm: 'Are you sure?' }
        ) %>
      <% end %>
    </div>
  <% elsif !(can? :edit, @product) && review.is_hidden? %>

  <% else %>
    <div class="well">
      <p><%= review.body %></p>
      <p><%= review.user.first_name %></p>
      <p><strong>Rating: </strong><%= review.rating %></p>
      <% if can? :edit, @product %>
        <%= link_to 'Hide', product_review_path(@product, review), method: :patch %>
      <% end %>
      <% if can? :destroy, review %>
        <%= link_to(
        'Delete',
        product_review_path(@product, review),
        method: :delete,
        data: { confirm: 'Are you sure?' }
        ) %>
      <% end %>
    </div>
  <% end %>
<% end %>
